<!DOCTYPE html>
<html lang="en">

<head>
	<title>VendezVous</title>
	<base href="/">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- meta tag to make the website Search Engine friendly-->
	<meta name="HandheldFriendly" content="True">
	<!-- meta tag for favicon-->
	<link rel="shortcut icon" href="/favicon.png">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
	<!-- Adding Google Font API -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Tangerine|Gugi|Indie+Flower">
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<style type="text/css">
		body {
			background-image: url("/assets/bagel.jpg");
			background-repeat: no-repeat;
			background-size: cover;
		}

		.heading h1 {
			font-size: 64px;
			font-family: 'Indie Flower', sans-serif;
			text-align: center;
			background-color: rgb(124, 124, 224);
			color: white;
			margin: 0;
		}

		.subheadings {
			width: 500px;
			margin: 30px auto 0 auto;
			border: 5px solid #000000;
			padding: 20px;
		}

		.subheadings .name img {
			display: inline;
			width: 100px;
			height: 100px;
			margin-left: 100px;
		}

		textarea {
			background-color: transparent;
			border-color: black;
		}

		input {
			background-color: transparent;
			border-color: black;
		}

		.buttons {
			padding-left: 5px;
		}

		.buttons button {
			background-color: transparent;
			border-color: black;
		}
	</style>
</head>

<body>
	<div class="heading">
		<h1>Profile</h1>
	</div>
	<br>
	<div class="buttons">
		<button onclick="location.href='/nearby'" type="button">Users Nearby</button>
		<button onclick="javascript:logout();">Logout from Facebook</button>
	</div>


	<div class="subheadings">
		<!-- <form action="/update-profile"> -->
		<div class="name">
			<h2>Name</h2>
			<input type="text" id="name" readonly>
			<div id="profilepic"></div>
			<br><br>
		</div>

		<div class="interests">
			<h2>Interests</h2>
			<textarea id="interests" rows="3" cols="54"></textarea>
			<br><br>
		</div>

		<div class="about">
			<h2>About</h2>
			<!-- <input type="text" name="about"> -->
			<textarea id="about" rows="6" cols="54"></textarea>
			<br><br>
		</div>

		<div class="button">
			<button onclick="javascript:saveData();">save</button>
		</div>
		<!-- </form> -->
	</div>

	<script>
	function statusChangeCallback(response) {
		console.log('statusChangeCallback');
		console.log(response);

		if (response.status === 'connected') {

			var accessToken = response.authResponse.accessToken;
			// Logged into your app and Facebook.
			getInfo();
		} else {
			// The person is not logged into your app or we are unable to tell.
			window.top.location = "/";
			document.getElementById('name').value = 'your name displayed here';
		}
	}

		window.fbAsyncInit = function() {
			FB.init({
				appId: 203968780201183,
				cookie: true, // enable cookies to allow the server to access
				// the session
				xfbml: true, // parse social plugins on this page
				version: 'v2.12', // use graph api version 2.8
				autoLogAppEvents: true,
				// status 	 : true /* reduces time wasted in checking if the user is logged in or not */
			});
			FB.getLoginStatus(function(response) {
				statusChangeCallback(response);
			});
		};

		(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) return;
			js = d.createElement(s);
			js.id = id;
			js.src = "https://connect.facebook.net/en_US/sdk.js";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));

		function logout() {
			FB.getLoginStatus(function(response) {
				if (response && response.status === 'connected') {
					FB.logout(function(response) {
						// document.location.reload();
						window.location = "/";
					});
				}
			});
		}

		function saveData() {
			FB.getLoginStatus(function(response) {
				if (response && response.status === 'connected') {
					var user_id = response.authResponse.userID
					var toSend = {
						"id": user_id,
						"bio": document.getElementById("about").value,
						"interests": document.getElementById("interests").value
					}
					$.post("/update-profile", toSend, function(data) {
						console.log(data);
					}, "json");
				}
			});
		}

		function getInfo() {
			FB.api('/me', 'GET', {
				fields: 'id,name,picture.width(150).height(150)'
			}, function(response) {
				// console.log("setting the name");
				document.getElementById("name").value = response.name;
				document.getElementById("profilepic").innerHTML = "<img src='" + response.picture.data.url + "' class=\"img-thumbnail\">";
				var toSend = {
					"id": response.id
				}
				/*$.get("/get-profile", function(data) {
					document.getElementById("about").value = data.bio;
					document.getElementById("interests").value = data.interests;
				}, "json");*/
				$.ajax({
					url: "/get-profile",
					// data: {"bio": bio, "interests": interests},
					type: "GET",
					beforeSend: function(xhr) {
						xhr.setRequestHeader("id", response.id);
					},
					success: function(data) {
						document.getElementById("about").value = data.bio;
						document.getElementById("interests").value = data.interests;
					}
				})
			});
		}
	</script>

	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
</body>

</html>
