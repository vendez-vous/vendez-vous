<!DOCTYPE html>
<html lang="en">

<head>
	<title>VendezVous</title>
	<base href="/">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- meta tag to make the website Search Engine friendly-->
	<meta name="HandheldFriendly" content="True">
	<!-- meta tag to refresh page after every 30 seconds -->
	<meta http-equiv="refresh" content="90">
	<!-- link for favicon-->
	<link rel="shortcut icon" href="/favicon.png">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
	<!-- Adding Google Font API -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Tangerine|Gugi|Indie+Flower">
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<style type="text/css">
		body {
			background-image: url("/assets/background.jpeg");
			background-repeat: no-repeat;
			background-size: cover;
			background-attachment: fixed;
		}

		.heading h1 {
			font-size: 64px;
			font-family: 'Indie Flower', sans-serif;
			text-align: center;
			/* background-color: rgb(124, 124, 224); */
			background-color: black;
			color: white;
			margin: 0;
		}

		.person {
			height: 525px;
		}

		.buttons {
			padding-left: 5px;
		}

		.person {
			padding: 30px 0 40px;
			text-align: center;
			background: white;
			position: relative;
			overflow: hidden;
		}

		.person .pic {
			display: inline-block;
			width: 130px;
			height: 130px;
			margin-bottom: 50px;
			z-index: 1;
			position: relative;
		}

		.person .pic::before {
			content: "";
			width: 100%;
			position: absolute;
			bottom: 135%;
			right: 0;
			left: 0;
			/* background: rgb(124, 124, 224); */
			background: black;
			transform: scale(3);
			transition: all 0.3s linear 0s;
		}

		.person:hover .pic::before {
			height: 100%;
		}

		.person:hover .pic::after {
			content: "";
			width: 100%;
			height: 100%;
			border-radius: 50%;
			/* background: rgb(124, 124, 224); */
			background: black;
			position: absolute;
			top: 0;
			left: 0;
			z-index: -1;
		}

		.person .pic img {
			width: 100%;
			height: 100%;
			border-radius: 50%;
			transform: scale(1);
			transition: all 0.9s ease 0s;
		}

		.person:hover .pic img {
			box-shadow: 0 0 0 14px #f7f5ec;
			transform: scale(0.7);
		}

		.person .content {
			margin-bottom: 30px;
		}

		.person .name {
			font-size: 22px;
			font-weight: 700;
			color: #4e5052;
			letter-spacing: 1px;
			/* text-transform: capitalize; */
			margin-bottom: 5px;
		}

		.person .interests {
			display: block;
			font-size: 15px;
			color: #4e5052;
			/* text-transform: capitalize; */
		}

		.person .about {
			display: block;
			font-size: 15px;
			color: #4e5052;
			/* text-transform: capitalize; */
		}

		.person .social {
			width: 100%;
			padding: 0;
			margin: 0;
			background: black;
			position: absolute;
			bottom: -100px;
			left: 0;
			transition: all 0.5s ease 0s;
		}

		.person:hover .social {
			bottom: 0;
		}

		.person .social li {
			display: inline-block;
		}

		.person .social li a {
			display: block;
			padding: 10px;
			color: white;
			font-size: 17px;
			transition: all 0.3s ease 0s;
		}

		.person .social li a:hover {
			color: black;
			background: #f7f5ec;
			text-decoration: none;
		}
	</style>
</head>

<body>
	<div class="heading">
		<h1>Nearby users available to meet</h1>
	</div>
	<br>
	<div class="buttons">
		<button class="w3-button w3-black" onclick="location.href='/profile'" type="button">Profile</button>
	</div>

	<br><br>

	<div class="container">
		<!-- <div class="row">
			<div class="col-md-3 col-sm-6">
				<div class="person">
					<div class="pic">
						<img src="https://lookaside.facebook.com/platform/profilepic/?asid=1785068044849293&height=150&width=150&ext=1524718829&hash=AeQZkCZsbMMADGXv" alt="Profile Picture">
					</div>
					<div class="content">
						<h3 class="name">Adit Kumar</h3>
						<span class="interests"><b>Interests</b></span>
						<span class="interests">Dancing, eating, sleeping, coding, panchayti</span><br>
						<span class="about"><b>About</b></span>
						<span class="about">Hey everyone! I am Adit Kumar, the myth, the legend, the one and only @addythechamp. Please follow me on facebook, Instagram and Snacpchat</span>
					</div>
					<ul class="social">
						<li>
							<a href="#"><i class="far fa-heart"></i></i></a>
						</li>
						<li>
							<a href="#"><i class="far fa-comments"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div> -->
	</div>

	<script type="text/javascript">
		// This is called with the results from from FB.getLoginStatus().
		function statusChangeCallback(response) {
			console.log('statusChangeCallback');
			console.log(response);

			if (response.status === 'connected') {
				var accessToken = response.authResponse.accessToken;
				// Logged into your app and Facebook.
				getInfo();
			} else {
				// The person is not logged into your app or we are unable to tell.
				window.top.location = "/";
				document.getElementById('status').innerHTML = 'Please login with Facebook to continue';
			}
		}

		function checkLoginState() {
			FB.getLoginStatus(function(response) {
				statusChangeCallback(response);
			});
		}

		window.fbAsyncInit = function() {
			FB.init({
				appId: 203968780201183,
				cookie: true, // enable cookies to allow the server to access
				// the session
				xfbml: true, // parse social plugins on this page
				version: 'v2.12', // use graph api version 2.8
				autoLogAppEvents: true,
				//  status 	 : true /* reduces time wasted in checking if the user is logged in or not */
			});

			FB.getLoginStatus(function(response) {
				statusChangeCallback(response);
			});
		};

		// Load the SDK asynchronously
		(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) return;
			js = d.createElement(s);
			js.id = id;
			js.src = "https://connect.facebook.net/en_US/sdk.js";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));

		function getInfo(userID) {
			FB.api('/me', 'GET', {
				fields: 'id'
			}, function(response) {
				var startPos;
				var geoOptions = {
					timeout: 10 * 1000
				}

				// send location
				var geoSuccess = function(position) {
					startPos = position;
					var toSend = {
						"id": response.id,
						"latitude": startPos.coords.latitude,
						"longitude": startPos.coords.latitude,
					}

					$.post("/send-location", toSend, function(data) {
						console.log(data);
					}, "json");
				};

				var geoError = function(error) {
					console.log('Error occurred. Error code: ' + error.code);
					// error.code can be:
					//   0: unknown error
					//   1: permission denied
					//   2: position unavailable (error response from location provider)
					//   3: timed out
				};

				navigator.geolocation.getCurrentPosition(geoSuccess, geoError, geoOptions);

				// get nearby users
				$.ajax({
					url: "/get-nearby",
					type: "GET",
					beforeSend: function(xhr) {
						xhr.setRequestHeader("id", response.id);
					},
					success: function(data) {
						// console.log('get nearby result:', data);
						if(data.length == 0) {
							$(".container").html("<div class=\"alert alert-dark\" role=\"alert\" align=\"center\">No nearby users! Please come back later.</div>");
							return;
						}
						// populate all nearby users
						var toSet = "<div class=\"row\">";
						for (i = 0; i < data.length; i++) {
							console.log(data[i]);
							if((i > 0) && (i % 4 == 0)) {
								toSet += "</div><br><div class=\"row\">";
							}
							toSet += "<div class=\"col-md-3 col-sm-6\"><div class=\"person\"><div class=\"pic\">";
							toSet += "<img src=\"" + data[i].picture + "\" alt=\"Profile Picture\">"; // set profile picture
							toSet += "</div><div class=\"content\">";
							toSet += "<h3 class=\"name\">" + data[i].user_name + "</h3>"; // set user name-textbox
							toSet += "<span class=\"interests\"><b>Interests</b></span>";
							toSet += "<span class=\"interests\">" + data[i].interests + "</span><br>"; // set user interests
							toSet += "<span class=\"about\"><b>About</b></span>";
							toSet += "<span class=\"about\">" + data[i].bio + "</span>"; // set user bio
							toSet += "</div><ul class=\"social\"><li>";
							if(data[i].match == true) {
								toSet += "<a href=\"mailto:" + data[i].link + "\" target=\"_blank\"><i class=\"far fa-envelope\"></i></a>"; // make msg btn
							}
							else {
								toSet += "<a onclick=\"javascript:like(" + data[i].id + ");\"><i class=\"far fa-heart\"></i></a>"; // make like btn
							}
							toSet += "</li></ul></div></div>";
						}
						toSet += "</div>";
						// console.log(toSet);
						// document.getElementsByClassName("conatiner").innerHTML = toSet;
						$(".container").html(toSet);
					}
				})
			});
		}

		function like(other_user) {
			FB.getLoginStatus(function(response) {
				if (response && response.status === 'connected') {
					var user_id = response.authResponse.userID
					var toSend = {
						"id": user_id,
						"other": other_user
					}
					$.post("/like", toSend, function(data) {
						console.log(data);
					}, "json");
				}
			});
		}
	</script>

	<!-- Ocdptional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
</body>

</html>
